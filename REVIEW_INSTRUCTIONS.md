# ⚠️ REVIEW INSTRUCTIONS

> **DELETE THIS FILE** after reading and addressing the issues.
> This file was generated by the Review Agent (Gemini).

## Workflow

1. Read the issues below
2. Fix the code
3. **DELETE this file** (`git rm REVIEW_INSTRUCTIONS.md`)
4. Commit with `Agent-Note:` trailer explaining your fixes

## Example Commit

```
fix: address review feedback

Agent-Note: Fixed SQL injection in auth.ts by using parameterized queries.
```

---

## Issues to Address

```toml
[review]
summary = "The PR incorrectly commits the ephemeral `REVIEW_INSTRUCTIONS.md` artifact instead of applying the fixes contained within it. Furthermore, the proposed CI changes introduce critical security vulnerabilities by exposing a Personal Access Token to untrusted code contexts."
decision = "REQUEST_CHANGES"

[[issues]]
severity = "critical"
file = "REVIEW_INSTRUCTIONS.md"
title = "Temporary agent artifact committed"
description = "This file is intended as a transient communication mechanism for the coding agent (to be read and deleted). It contains unaddressed critical security feedback. Committing this file indicates the automated 'wake' cycle failed or was bypassed."
suggestion = "Remove this file. Address the security issues described within it (specifically regarding `.claude/commands/wake.md` and the CI workflow) before pushing again."

[[issues]]
severity = "critical"
file = ".github/workflows/gemini-pr-review-plus.yml"
title = "Insecure PAT usage with untrusted checkout"
description = "Using `secrets.GH_TOKEN` (a Personal Access Token) to checkout `${{ github.head_ref }}` exposes high-privilege credentials to the environment where potentially untrusted PR code is checked out. This is a 'Pwn Request' vulnerability vector."
suggestion = "Revert to `secrets.GITHUB_TOKEN`. If write access is needed, rely on the default token's permissions or a scoped GitHub App, but do not expose a PAT while checking out unmerged PR code."

[[issues]]
severity = "critical"
file = ".claude/commands/wake.md"
title = "Excessive agent permissions (Remote Code Execution risk)"
description = "The configuration grants `Bash(*)` permission to the agent. In a security-sensitive repository handling transactions/keys, allowing an AI agent unrestricted shell execution is extremely risky and susceptible to prompt injection attacks."
suggestion = "Remove `Bash(*)` permissions. If shell commands are necessary, restrict the agent to executing specific, safe scripts from the repository."

[[issues]]
severity = "important"
file = ".github/workflows/gemini-pr-review-plus.yml"
title = "Workflow permission escalation"
description = "Escalating workflow permissions to `contents: write` on a PR review workflow is dangerous, particularly if the workflow runs on `pull_request_target` or receives input from forks."
suggestion = "Maintain `contents: read`. For providing feedback, stick to PR comments or creating status checks rather than pushing commits directly to the contributor's branch."
```
