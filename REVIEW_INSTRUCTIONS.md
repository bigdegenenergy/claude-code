# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "The PR effectively transitions the AI agent workflow from TOML to JSON and improves user interaction with natural language triggers. However, the JSON extraction logic is brittle, and the broadened triggers require strict authorization verification to prevent unauthorized usage.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "important",
      "file": ".github/workflows/gemini-pr-review-plus.yml",
      "line": 0,
      "title": "Fragile JSON fallback extraction regex",
      "description": "The fallback regex `r'\\{.*\\}'` combined with `re.DOTALL` is greedy. If the LLM provides the JSON object but follows it with any explanatory text containing a closing brace `}` (e.g., 'Hope this helps with your function {foo}.'), the regex will capture the extra text, resulting in invalid syntax that causes `json.loads` to crash.",
      "suggestion": "Remove the fallback or implement a try-catch mechanism that logs a warning if the markdown fence is missing. Given the prompt instructs the LLM to provide valid JSON, enforcing the code block fence is safer than a greedy regex match on the entire body."
    },
    {
      "id": 2,
      "severity": "critical",
      "file": ".github/workflows/claude-code-implement.yml",
      "line": 0,
      "title": "Verify Data Handover Protocol (TOML vs JSON)",
      "description": "The `gemini-pr-review-plus` workflow now outputs `REVIEW_DATA_JSON` instead of TOML. You must verify that the python script in `claude-code-implement.yml` has been updated to search for and parse this new JSON format. If it still searches for TOML or uses `tomllib`, the 'accept' command will silently fail or error out.",
      "suggestion": "Ensure the context retrieval logic searches for the `<!-- REVIEW_DATA_JSON:` tag and uses `json.loads()`."
    },
    {
      "id": 3,
      "severity": "critical",
      "file": ".github/workflows/claude-code-implement.yml",
      "line": 0,
      "title": "Authorization check for natural language triggers",
      "description": "Moving to natural language triggers like 'yes', 'okay', and 'accept' significantly increases the surface area for accidental or malicious triggering. If the workflow runs on `issue_comment`, ensure there is an explicit check that `github.event.comment.author_association` is `OWNER`, `MEMBER`, or `COLLABORATOR`.",
      "suggestion": "Add or verify the existence of a permissions check at the start of the script or in the workflow `if` condition to prevents random users from triggering code implementation agents."
    }
  ]
}
```