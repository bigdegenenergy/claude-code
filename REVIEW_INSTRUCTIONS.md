# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```toml
[review]
summary = "This PR introduces a robust 'human-in-the-loop' AI coding workflow. The security controls (trusted script checkout, tool restrictions, pinned versions) are commendable and address major risks. However, there is a logic bug regarding PR detection for forks, and the prompt construction could be hardened against injection."
decision = "REQUEST_CHANGES"

[[issues]]
severity = "important"
file = ".github/workflows/pr-review-prompt.yml"
line = 38
title = "PR lookup fails for forks"
description = "The `head` reference string is constructed using `context.repo.owner`, which assumes the PR branch exists in the base repository. This will fail to identify PRs originating from forks (where the owner differs)."
suggestion = "Use `context.payload.workflow_run.head_repository.owner.login` to correctly identify the owner of the head branch."

[[issues]]
severity = "important"
file = ".github/scripts/claude-code-implement.js"
line = 43
title = "Potential prompt injection via user intent"
description = "The `USER_INTENT` (derived from PR comments) is appended directly to the prompt. A malicious user with comment access could theoretically provide instructions that override the agent's constraints (e.g., attempting to exfiltrate secrets via file write)."
suggestion = "Wrap the `USER_INTENT` in distinct delimiters (e.g., `<user_request>...</user_request>`) and explicitly instruct the model in the system prompt to treat content within those tags as data/requests to be fulfilled only if they don't conflict with security rules."

[[issues]]
severity = "suggestion"
file = ".github/scripts/claude-code-implement.js"
line = 1
title = "Verify module system compatibility"
description = "The script uses CommonJS `require` syntax in a `.js` file. If the project's `package.json` specifies `\"type\": \"module\"` (common in modern TS/Node projects), or if the `@anthropic-ai/claude-code` SDK is ESM-only, this script will fail at runtime."
suggestion = "Rename the script to `.cjs` to enforce CommonJS handling, or verify that the project configuration supports `require` in `.js` files."

[[issues]]
severity = "suggestion"
file = ".github/workflows/claude-code-implement.yml"
line = 44
title = "Verify SDK functionality with --ignore-scripts"
description = "The installation uses `--ignore-scripts` for security, which is good practice. However, ensure that `@anthropic-ai/claude-code` does not rely on post-install scripts (e.g., for downloading binaries or setting up local configuration) to function properly."
suggestion = "Verify the agent runs successfully in a clean environment with this flag."
```