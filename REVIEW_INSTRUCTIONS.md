# ⚠️ REVIEW INSTRUCTIONS

> **DELETE THIS FILE** after reading and addressing the issues.
> This file was generated by the Review Agent (Gemini).

## Workflow

1. Read the issues below
2. Fix the code
3. **DELETE this file** (`git rm REVIEW_INSTRUCTIONS.md`)
4. Commit with `Agent-Note:` trailer explaining your fixes

## Example Commit

```
fix: address review feedback

Agent-Note: Fixed SQL injection in auth.ts by using parameterized queries.
```

---

## Issues to Address

```toml
[review]
summary = "The transition to a git-native agent workflow is a solid architectural improvement. However, the CI workflow introduces security risks by writing long-lived credentials to disk and requesting unnecessary permissions. Additionally, the reliance on a repository secret in a standard `pull_request` trigger will break the workflow for external contributors (forks)."
decision = "REQUEST_CHANGES"

[[issues]]
severity = "critical"
file = ".github/workflows/gemini-pr-review-plus.yml"
title = "Insecure handling of GH_TOKEN"
description = "The workflow writes the sensitive `GH_TOKEN` (a Personal Access Token) to a file named `.github_token` on the runner. This persists the credential on the filesystem, increasing the risk of exfiltration. The `gh` CLI supports authentication directly via environment variables, which is more secure."
suggestion = "Remove the `echo ... > .github_token` step. Instead, map the secret to the `GH_TOKEN` environment variable in the `env` block of the step running `gh` commands."

[[issues]]
severity = "important"
file = ".github/workflows/gemini-pr-review-plus.yml"
title = "Redundant write permissions"
description = "The workflow requests `contents: write` for the default `GITHUB_TOKEN`. However, the checkout and git operations are explicitly configured to use `secrets.GH_TOKEN`. Granting write access to `GITHUB_TOKEN` is likely unnecessary and violates the principle of least privilege."
suggestion = "Remove `contents: write` from the permissions block unless there is a specific step (other than checkout/push) that requires the default token to have write access."

[[issues]]
severity = "important"
file = ".github/workflows/gemini-pr-review-plus.yml"
title = "Workflow broken for forks"
description = "The workflow uses `secrets.GH_TOKEN` in a `pull_request` event. Secrets are not available to PRs originating from forks. This means the review agent will fail to run for any external contributions."
suggestion = "If external contributions are expected, consider handling the missing secret gracefully (skipping the review) or using `pull_request_target` (with strict security checks on the checkout step)."
```
