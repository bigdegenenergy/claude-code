# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "This PR introduces significant capabilities including the Lobster workflow engine and Gateway ChatOps. I have identified critical security issues regarding command injection in the shell/Python interfaces and a race condition in state persistence. Additionally, the ChatOps authentication model has spoofing risks that need addressing.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": ".claude/commands/workflow-approve.md",
      "line": 0,
      "title": "Command Injection in Python/Shell Bridge",
      "description": "The command definition interpolates shell variables (like `$USER`) directly into a Python script string passed to `python3 -c`. Malicious input containing quotes can escape the string literal and execute arbitrary Python code (RCE).",
      "suggestion": "Pass variables via environment variables (`export USER=\"$USER\"`) and read them in Python using `os.environ['USER']`."
    },
    {
      "id": 2,
      "severity": "important",
      "file": ".claude/workflows/lobster/state.py",
      "line": 0,
      "title": "Race Condition in save_approval_request",
      "description": "The `save_approval_request` method writes to disk without the file locking mechanism used in `save_state`, creating a race condition where concurrent requests could corrupt data.",
      "suggestion": "Apply the `_lock_file` context manager to the `save_approval_request` method."
    },
    {
      "id": 3,
      "severity": "important",
      "file": ".github/workflows/gateway-webhook.yml",
      "line": 0,
      "title": "Shell Injection Risk in Webhook Workflow",
      "description": "Injecting the `client_payload.command` directly into the shell command arguments in the GitHub Action workflow is unsafe and can lead to shell injection depending on the input.",
      "suggestion": "Use environment variables to pass the payload to the script: `env: COMMAND: ${{ github.event.client_payload.command }}`."
    },
    {
      "id": 4,
      "severity": "important",
      "file": ".claude/gateway/commands.py",
      "line": 0,
      "title": "User Impersonation Risk in Gateway",
      "description": "The permission system relies on the `user_id` provided in the webhook payload. Since `repository_dispatch` often uses a shared token, any holder of the token can spoof the `user_id` to bypass admin restrictions.",
      "suggestion": "If possible, validate the payload signature from the chat platform or document strict access controls on the webhook PAT. Ensure `users.json` is not writeable by the workflow."
    },
    {
      "id": 5,
      "severity": "suggestion",
      "file": ".claude/commands/browser.md",
      "line": 0,
      "title": "Hardcoded Credentials",
      "description": "Documentation examples contain hardcoded passwords.",
      "suggestion": "Use environment variables (e.g., `process.env.PASSWORD`) in examples."
    }
  ]
}
```